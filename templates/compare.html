<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Compare AI Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f7ff',
                            100: '#e0f0fe',
                            200: '#bae0fd',
                            300: '#7cc8fb',
                            400: '#36adf6',
                            500: '#0c96e6',
                            600: '#0078c8',
                            700: '#0061a3',
                            800: '#005286',
                            900: '#00396b',
                        },
                        secondary: {
                            50: '#f5f2ff',
                            100: '#ede8ff',
                            200: '#dbd0ff',
                            300: '#c3a9ff',
                            400: '#a475ff',
                            500: '#8a4dff',
                            600: '#7a2df7',
                            700: '#6b20e0',
                            800: '#5a1bb8',
                            900: '#4b1a95',
                        },
                        accent: {
                            50: '#fff1f3',
                            100: '#ffe4e8',
                            200: '#fecdd6',
                            300: '#fda4b4',
                            400: '#fb6f8c',
                            500: '#f33a5f',
                            600: '#e11d48',
                            700: '#be123c',
                            800: '#9f1239',
                            900: '#881337',
                        },
                        dark: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        },
                    },
                    fontFamily: {
                        'display': ['"Space Grotesk"', 'sans-serif'],
                        'body': ['"Outfit"', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .light-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #f8fafc;
            background: radial-gradient(circle at top right, #f0f7ff 0%, #f8fafc 50%);
        }
        .dark .light-background { display: none; }
        .dark-background {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #0f172a, #1e293b);
        }
        .dark .dark-background { display: block; }
        .aurora-container {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            opacity: 0.7;
        }
        .aurora {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: conic-gradient(
                from 230.29deg at 51.63% 52.16%,
                #0c96e6 0deg,
                #8a4dff 67.5deg,
                #f33a5f 198.75deg,
                #0c96e6 360deg
            );
            opacity: 0.15;
            filter: blur(60px);
            animation: aurora 10s linear infinite;
        }
        .dark .aurora { opacity: 0.2; filter: blur(80px); }
        @keyframes aurora {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .blob-container { position: absolute; width: 100%; height: 100%; overflow: hidden; }
        .blob { position: absolute; border-radius: 50%; filter: blur(40px); }
        .blob-1 { top: 20%; left: 15%; width: 300px; height: 300px; background: rgba(12, 150, 230, 0.15); animation: blob 15s infinite alternate; }
        .blob-2 { top: 60%; left: 70%; width: 350px; height: 350px; background: rgba(138, 77, 255, 0.15); animation: blob 18s infinite alternate-reverse; animation-delay: 2s; }
        .blob-3 { top: 70%; left: 20%; width: 250px; height: 250px; background: rgba(243, 58, 95, 0.15); animation: blob 20s infinite alternate; animation-delay: 4s; }
        .dark .blob-1 { background: rgba(12, 150, 230, 0.2); }
        .dark .blob-2 { background: rgba(138, 77, 255, 0.2); }
        .dark .blob-3 { background: rgba(243, 58, 95, 0.2); }
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .grid-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: 50px 50px;
            background-image: 
                linear-gradient(to right, rgba(203, 213, 225, 0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(203, 213, 225, 0.1) 1px, transparent 1px);
            opacity: 0.5;
        }
        .dark .grid-pattern {
            background-image: 
                linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
        }
        .glass-card {
            background: rgba(255,255,255,0.96);
            color: #1e293b;
        }
        .dark .glass-card {
            background: rgba(30,41,59,0.85);
            color: #fff;
        }
        .btn-primary, .btn-secondary {
            color: #fff;
        }
        .btn-primary {
            background: linear-gradient(to right, #6366f1, #ec4899);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(to right, #818cf8, #f472b6);
        }
        .btn-secondary {
            background: rgba(30,41,59,0.7);
            border: 1px solid rgba(100,116,139,0.2);
        }
        .btn-secondary:hover {
            background: rgba(100,116,139,0.2);
        }
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, #0c96e6, #8a4dff, #f33a5f);
        }
        body, .font-body {
            color: #1e293b;
        }
        .dark body, .dark .font-body {
            color: #fff;
        }
        input, select, table, th, td, label, .font-display, .font-bold, .font-medium {
            color: #1e293b !important;
        }
        .dark input, .dark select, .dark table, .dark th, .dark td, .dark label, .dark .font-display, .dark .font-bold, .dark .font-medium {
            color: #fff !important;
        }
        ::placeholder { color: #64748b; opacity: 1; }
        .dark ::placeholder { color: #cbd5e1; }
        .glass-card .text-gray-200 { color: #334155 !important; }
        .dark .glass-card .text-gray-200 { color: #e5e7eb !important; }
        .glass-card .text-primary-100 { color: #00396b !important; }
        .dark .glass-card .text-primary-100 { color: #bae0fd !important; }

        /* --- Fix for select dropdown in dark mode --- */
        select.search-select, .dark select.search-select {
            background: #fff;
            color: #1e293b;
            border: 1px solid #cbd5e1;
        }
        .dark select.search-select {
            background: #1e293b;
            color: #fff;
            border: 1px solid #334155;
        }
        select.search-select option, .dark select.search-select option {
            background: #fff;
            color: #1e293b;
        }
        .dark select.search-select option {
            background: #1e293b;
            color: #fff;
        }
        /* --- Fix for search button visibility in dark mode --- */
        .btn-primary, .dark .btn-primary {
            color: #fff !important;
            border: none;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.04);
        }
        /* --- Fix for search input in dark mode --- */
        input.search-select, .dark input.search-select {
            background: #fff;
            color: #1e293b;
            border: 1px solid #cbd5e1;
        }
        .dark input.search-select {
            background: #1e293b;
            color: #fff;
            border: 1px solid #334155;
        }
    </style>
</head>
<body class="font-body text-dark-800 dark:text-white min-h-screen flex flex-col relative">
    <!-- Background Effects -->
    <div class="background-container">
        <div class="light-background"></div>
        <div class="dark-background"></div>
        <div class="aurora-container"><div class="aurora"></div></div>
        <div class="blob-container">
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
            <div class="blob blob-3"></div>
        </div>
        <div class="grid-pattern"></div>
    </div>

    <!-- Theme Toggle Button -->
    <div class="absolute top-4 right-4 z-50">
        <button id="theme-toggle" class="p-3 rounded-full hover:bg-white/10 transition-all duration-300 hover:rotate-12">
            <!-- Sun icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 dark:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <!-- Moon icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </button>
    </div>

    <section class="container mx-auto py-8 px-4 space-y-8">
        <div class="flex items-center justify-between mb-8">
            <h1 class="font-display text-3xl md:text-4xl font-bold tracking-tight text-white drop-shadow">
                Compare AI Tools
            </h1>
            <a href="{% url 'browse' %}" class="btn-secondary px-4 py-2 rounded-full hover:bg-white/10 transition-all duration-300">
                <i class="fas fa-arrow-left mr-2"></i> Back to Browse
            </a>
        </div>

        <!-- Search and Add Tool to Comparison Form -->
        <form method="get" class="mb-8 flex flex-col sm:flex-row items-center gap-4 glass-card p-4 rounded-xl border border-white/20">
            {% for id in current_ids %}
                <input type="hidden" name="tools" value="{{ id }}">
            {% endfor %}
            <div class="relative w-full sm:w-auto">
                <input type="text" id="toolSearch" placeholder="Search tools..." autocomplete="off"
                    class="search-select w-full sm:w-64 mb-2 sm:mb-0" onkeyup="filterTools()">
                <select id="toolSelect" name="tools" class="search-select w-full sm:w-64">
                    <option value="" disabled selected>Select tool to add...</option>
                    {% for tool in all_tools %}
                        <option value="{{ tool.id }}">{{ tool.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn-primary px-4 py-2 rounded-full">Add</button>
        </form>

        <!-- Tool Selection for Comparison -->
        <form action="{% url 'compare' %}" method="get" id="compareForm" class="mb-8">
          <div class="flex justify-end mb-4">
            <button type="submit" id="compareButton"
                class="btn-primary px-5 py-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
                Compare (<span id="selectedCount">0</span>)
            </button>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
            {% for tool in tools %}
            <div class="glass-card p-6 rounded-2xl border border-white/20 relative">
              <input type="checkbox" name="tools" value="{{ tool.id }}"
                  class="absolute top-4 right-4 w-5 h-5 accent-indigo-500"
                  onchange="updateSelectedCount()">
              <div class="flex items-center space-x-4 mb-4">
                <img src="{{ tool.image.url }}" alt="{{ tool.name }}" class="w-12 h-12 rounded-lg shadow">
                <div>
                  <h3 class="font-bold text-lg">{{ tool.name }}</h3>
                  <div class="flex items-center">
                    <i class="fas fa-star text-yellow-400 text-xs mr-1"></i>
                    <span class="text-sm">{{ tool.rating }}</span>
                  </div>
                </div>
              </div>
              <p class="text-gray-200 text-sm mb-2">{{ tool.description|truncatewords:20 }}</p>
              <span class="inline-block px-3 py-1 text-xs bg-primary-500/20 text-primary-100 rounded-full">
                {{ tool.category.name }}
              </span>
            </div>
            {% endfor %}
          </div>
        </form>

        {% if tools|length >= 2 %}
            <div class="glass-card rounded-xl p-6 border border-white/20 overflow-x-auto">
                <table class="comparison-table w-full">
                    <thead class="border-b border-white/20">
                        <tr>
                            <th class="p-4 text-left font-display text-lg">Feature</th>
                            {% for tool in tools %}
                            <th class="p-4 text-left font-display text-lg align-top">
                                <div class="flex flex-col items-center space-y-2">
                                    <div class="flex items-center space-x-2">
                                        <img src="{{ tool.image.url }}" alt="{{ tool.name }}" class="w-10 h-10 rounded-lg shadow">
                                        <span class="font-semibold">{{ tool.name }}</span>
                                    </div>
                                    <!-- Remove button -->
                                    <form method="get" style="display:inline;">
                                        {% for id in current_ids %}
                                            {% if id != tool.id|stringformat:"s" %}
                                                <input type="hidden" name="tools" value="{{ id }}">
                                            {% endif %}
                                        {% endfor %}
                                        <button type="submit" title="Remove" class="ml-2 text-red-500 hover:text-red-700">
                                            <i class="fas fa-times-circle"></i>
                                        </button>
                                    </form>
                                </div>
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for feature in features %}
                        <tr class="border-b border-white/10">
                            <td class="p-4 font-medium">{{ feature.name }}</td>
                            {% for value in feature.values %}
                            <td class="p-4 align-top">
                                {% if feature.name == 'Rating' %}
                                    <div class="flex items-center">
                                        <span class="mr-2">{{ value }}</span>
                                        <i class="fas fa-star text-yellow-400"></i>
                                    </div>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="glass-card rounded-xl p-6 border border-white/20 text-center">
                <p class="text-lg">Please select at least 2 tools to compare.</p>
                <a href="{% url 'browse' %}" class="btn-primary px-4 py-2 mt-4 inline-block">
                    Browse Tools
                </a>
            </div>
        {% endif %}
    </section>

    <footer class="glass border-t border-white/10 mt-12">
        <div class="container mx-auto py-8 px-4 text-center text-dark-500 dark:text-dark-400">
            &copy; 2023 AI Tools Directory. All rights reserved.
        </div>
    </footer>

    <script>
        // Theme toggle with localStorage
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        document.getElementById('theme-toggle').addEventListener('click', function() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('color-theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('color-theme', 'dark');
            }
        });

        // Fix compare button enable/disable
        function updateSelectedCount() {
            const checked = document.querySelectorAll('input[name="tools"]:checked').length;
            document.getElementById('selectedCount').textContent = checked;
            document.getElementById('compareButton').disabled = checked < 2;
        }
        document.addEventListener('DOMContentLoaded', updateSelectedCount);

        // Search filter for select options
        function filterTools() {
            var input = document.getElementById('toolSearch').value.toLowerCase();
            var select = document.getElementById('toolSelect');
            for (var i = 0; i < select.options.length; i++) {
                var option = select.options[i];
                if (option.value === "") continue;
                option.style.display = option.text.toLowerCase().includes(input) ? "" : "none";
            }
        }
        // Set placeholder color for select on load
        document.addEventListener('DOMContentLoaded', function() {
            var select = document.getElementById('toolSelect');
            if(select.value === "") {
                select.style.color = "#e5e7eb";
            }
            select.addEventListener('change', function() {
                if(this.value === "") {
                    this.style.color = "#e5e7eb";
                } else {
                    this.style.color = "#fff";
                }
            });
        });
    </script>
</body>
</html>